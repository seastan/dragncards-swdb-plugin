{
    "automation": {
        "postNewGameActionList": [
            ["SET", "/playerData/player1/label", "Empire"],
            ["SET", "/playerData/player2/label", "Rebels"],
            ["PROMPT", "player1", "startGame"]
        ],
        "postLoadActionList": [
            ["DRAW_STARTING_HANDS"],
            ["SET", "/started", true],
            ["REFILL_GALAXY_ROW"],
            ["SET_TRACKER_VALUE", 3]
        ],
        "gameRules": {
            "addResourcesWhenCardEntersPlay": {
                "_comment": "Add card's resource property to player's resources when card enters Play group",
                "type": "trigger",
                "listenTo": ["/cardById/*/groupId"],
                "condition": ["AND",
                    ["IN_STRING", "$TARGET.groupId", "Play"],
                    ["NOT", ["PREV", ["IN_STRING", "$TARGET.groupId", "Play"]]],
                    ["DEFINED", "$TARGET.currentFace.resources"],
                    ["GREATER_THAN", "$TARGET.currentFace.resources", 0]
                ],
                "then": [
                    ["INCREASE_VAL", "/playerData/$TARGET.controller/resources", "$TARGET.currentFace.resources"],
                    ["FADE_TEXT_PLAYER", "$TARGET.controller", "+{{$TARGET.currentFace.resources}} token:resource"],
                    ["LOG", "└── gained {{$TARGET.currentFace.resources}} resources."]
                ]
            },
            "destroyDamagedCards": {
                "_comment": "Destroy cards when damage equals or exceeds hit points",
                "type": "trigger",
                "listenTo": ["/cardById/*/tokens/damage"],
                "condition": ["AND",
                    ["DEFINED", "$TARGET.currentFace.hitPoints"],
                    ["GREATER_THAN", "$TARGET.currentFace.hitPoints", 0],
                    ["GREATER_EQUAL", "$TARGET.tokens.damage", "$TARGET.currentFace.hitPoints"],
                    ["DEFINED", "$TARGET.discardGroupId"]
                ],
                "then": ["DESTROY_CARD", "$TARGET"]
            },
            "updatePlayerScores": {
                "_comment": "Update player scores based on victory pile size",
                "type": "trigger",
                "listenTo": ["/groupById/player1VictoryPile/stackIds", "/groupById/player2VictoryPile/stackIds"],
                "condition": ["TRUE"],
                "then": [
                    ["SET", "/playerData/player1/score", ["LENGTH", "$GAME.groupById.player1VictoryPile.stackIds"]],
                    ["SET", "/playerData/player2/score", ["LENGTH", "$GAME.groupById.player2VictoryPile.stackIds"]]
                ]
            },
            "updateAttackStrengthWhenModifierChanged": {
                "_comment": "Update player scores based on victory pile size",
                "type": "trigger",
                "listenTo": ["/cardById/*/tokens/attackModifier"],
                "condition": "$TARGET.isAttacking",
                "then": [
                    ["VAR", "$DELTA", ["SUBTRACT", "$TARGET.tokens.attackModifier", ["PREV", "$TARGET.tokens.attackModifier"]]],
                    ["INCREASE_VAL", "/playerData/$TARGET.controller/attack", "$DELTA"]
                ]
            },
            "checkGameOver": {
                "_comment": "Check for game over when player scores change",
                "type": "trigger",
                "listenTo": ["/playerData/*/score"],
                "condition": ["OR",
                    ["GREATER_EQUAL", "$GAME.playerData.player1.score", 3],
                    ["GREATER_EQUAL", "$GAME.playerData.player2.score", 3]
                ],
                "then": [
                    ["COND",
                        ["GREATER_EQUAL", "$GAME.playerData.player1.score", 3],
                        [
                            ["LOG", "[game] The Empire has destroyed 3 bases and wins the game!"],
                            ["SET", "/victoryState", "Empire"],
                            ["SAVE_GAME"],
                            ["PROMPT", "$PLAYER_ORDER", "restartGame", "The Empire has destroyed 3 bases and wins the game!"]
                        ],
                        ["GREATER_EQUAL", "$GAME.playerData.player2.score", 3],
                        [
                            ["LOG", "[game] The Rebels have destroyed 3 bases and win the game!"],
                            ["SET", "/victoryState", "Rebels"],
                            ["SAVE_GAME"],
                            ["PROMPT", "$PLAYER_ORDER", "restartGame", "The Rebels have destroyed 3 bases and win the game!"]
                        ]
                    ]
                ]
            },
            "highlightAttackingCards": {
                "_comment": "Set attacking cards border color to green",
                "type": "trigger",
                "listenTo": ["/cardById/*/isAttacking"],
                "condition": ["TRUE"],
                "then": [
                    ["COND",
                        ["EQUAL", "$TARGET.isAttacking", true],
                        ["SET", "/cardById/$TARGET_ID/borderColor", "green"],
                        ["TRUE"],
                        ["SET", "/cardById/$TARGET_ID/borderColor", null]
                    ]
                ]
            },
            "highlightAttackedCards": {
                "_comment": "Set cards that attacked this turn border color to red",
                "type": "trigger",
                "listenTo": ["/cardById/*/hasAttackedThisTurn"],
                "condition": ["TRUE"],
                "then": [
                    ["COND",
                        ["EQUAL", "$TARGET.hasAttackedThisTurn", true],
                        ["SET", "/cardById/$TARGET_ID/borderColor", "red"],
                        ["TRUE"],
                        ["SET", "/cardById/$TARGET_ID/borderColor", null]
                    ]
                ]
            },
            "highlightPurchaseableCards": {
                "_comment": "Set cards that can be purchased border color to orange",
                "type": "trigger",
                "priority": 5,
                "listenTo": ["/playerData/*/resources", "/groupById/sharedGalaxyRow/stackIds"],
                "condition": ["TRUE"],
                "then": [
                    ["VAR", "$RESOURCES", "$GAME.playerData.{{$GAME.currentPlayer}}.resources"],
                    ["VAR", "$FACTION", 
                        ["COND",
                            ["EQUAL", "$GAME.currentPlayer", "player1"],
                            "Empire",
                            ["TRUE"],
                            "Rebel"
                        ]
                    ],
                    ["FOR_EACH_VAL", "$CARD_ID", "$GAME.groupById.sharedGalaxyRow.parentCardIds", [
                        ["VAR", "$CARD", "$GAME.cardById.{{$CARD_ID}}"],
                        ["COND",
                            ["AND",
                                ["LESS_EQUAL", "$CARD.currentFace.cost", "$RESOURCES"],
                                ["OR",
                                    ["EQUAL", "$CARD.currentFace.faction", "Neutral"],
                                    ["EQUAL", "$CARD.currentFace.faction", "$FACTION"]
                                ]
                            ],
                            ["SET", "/cardById/{{$CARD_ID}}/borderColor", "orange"],
                            ["TRUE"],
                            ["SET", "/cardById/{{$CARD_ID}}/borderColor", null]
                        ]
                    ]],
                    ["COND",
                        ["AND",
                            ["GREATER_EQUAL", "$RESOURCES", 2],
                            ["GROUP_NOT_EMPTY", "sharedOuterRimPilotDeck"]
                        ],
                        ["SET", "/cardById/{{$GAME.groupById.sharedOuterRimPilotDeck.parentCardIds.[0]}}/borderColor", "orange"],
                        ["AND",
                            ["LESS_THAN", "$RESOURCES", 2],
                            ["GROUP_NOT_EMPTY", "sharedOuterRimPilotDeck"]
                        ],
                        ["SET", "/cardById/{{$GAME.groupById.sharedOuterRimPilotDeck.parentCardIds.[0]}}/borderColor", null]
                    ]
                ]
            },
            "gainForceWhenCardPlayed": {
                "_comment": "Gain force when a card with force property is played",
                "type": "trigger",
                "listenTo": ["/cardById/*/groupId"],
                "condition": ["AND",
                    ["IN_STRING", "$TARGET.groupId", "Play"],
                    ["NOT", ["PREV", ["IN_STRING", "$TARGET.groupId", "Play"]]],
                    ["NOT_EQUAL", "$TARGET.controller", "shared"],
                    ["DEFINED", "$TARGET.currentFace.force"],
                    ["GREATER_THAN", "$TARGET.currentFace.force", 0]
                ],
                "then": [
                    ["LOG", "└── {{$TARGET.controller}} gained {{$TARGET.currentFace.force}} force."],
                    ["GAIN_N_FORCE", "$TARGET.controller", "$TARGET.currentFace.force"]
                ]
            },
            "rotateFactionCards": {
                "_comment": "Rotate cards in galaxy row based on faction",
                "type": "trigger",
                "listenTo": ["/cardById/*/groupId"],
                "condition": ["AND",
                    ["EQUAL", "$TARGET.groupId", "sharedGalaxyRow"],
                    ["DEFINED", "$TARGET.currentFace.faction"]
                ],
                "then": [
                    ["COND",
                        ["EQUAL", "$TARGET.currentFace.faction", "Rebel"],
                        [
                            ["SET", "/cardById/$TARGET_ID/rotationByPlayer/player1", 180],
                            ["SET", "/cardById/$TARGET_ID/rotationByPlayer/player2", 0]
                        ],
                        ["EQUAL", "$TARGET.currentFace.faction", "Empire"],
                        [
                            ["SET", "/cardById/$TARGET_ID/rotationByPlayer/player1", 0],
                            ["SET", "/cardById/$TARGET_ID/rotationByPlayer/player2", 180]
                        ],
                        ["EQUAL", "$TARGET.currentFace.faction", "Neutral"],
                        [
                            ["SET", "/cardById/$TARGET_ID/rotationByPlayer/player1", 90],
                            ["SET", "/cardById/$TARGET_ID/rotationByPlayer/player2", 90]
                        ]
                    ]
                ]
            },
            "showEndTurnSuggestion": {
                "_comment": "Show end turn suggestion when player has no more actions available",
                "type": "trigger",
                "priority": 10,
                "listenTo": ["/groupById/*/stackIds", "/playerData/*/resources", "/cardById/*/tokens/attackModifier", "/cardById/*/hasAttackedThisTurn"],
                "condition": ["TRUE"],
                "then": [
                    ["CHECK_END_TURN_SUGGESTION"]
                ]
            }
        }
    }
}
